# System Requirements

* Ubuntu 20.04
* ROS Noetic
* Python 3.8 + Pandas (1.2.4)
* QTrobot

# Preliminary Operations

## Install ROS Noetic
Follow the instructions on http://wiki.ros.org/noetic/Installation/Ubuntu

Finalize the configuration and setup of the ROS environment following the instructions on http://wiki.ros.org/ROS/Tutorials/InstallingandConfiguringROSEnvironment

If you are not familiar with ROS, we recommend you to go through the Beginner Level Tutorials (http://wiki.ros.org/ROS/Tutorials), up to **[16] Examining the Simple Service and Client** included.

It is very convenient to have access to the ROS commands and the catkin workspace from all terminal shells.
To do so, edit the .bashrc file to source them:
```
$ gedit .bashrc
```
And add at the end of the file the lines:
```
source /opt/ros/noetic/setup.bash
source ~/catkin_ws/devel/setup.bash
```

## Install Pandas
Make sure you have Python 3.8 installed, with `python3 --version`.

Install pip (to check if you already have it, type `pip --version`):
```
$ sudo apt install python3-pip
```
Then:
```
$ sudo -H pip3 install pandas
```

## Configure your ROS Environment for QTrobot (I HAVEN'T CHECKED THIS SECTION YET AFTER UPGRADE)
```
$ git clone https://github.com/luxai-qtrobot/software.git
```

Browse inside the cloned folder (called *software*), then copy the content of the *headers* folder into your catkin *devel* folder:
```
$ cp -r headers/* ~/catkin_ws/devel/
```

Make sure the QTrobot is plugged and on and connect your laptop to the WiFi network of the robot (for the CHILI robot, the network SSID is *QT109* and the password is written on the index page of the QTrobot User Manual).

In a terminal tab, get the IP ADDRESS of your laptop (it should be something like 10.42.0.***):
```
$ ifconfig
```

Update your *.bash_aliases* file to use the roscore of QTrobot:
```
$ gedit ~/.bash_aliases
```
And add at the end of the file the lines:
```
source /opt/ros/kinetic/setup.bash
source ~/catkin_ws/devel/setup.bash

## QTrobot
export ROS_IP=<your IP address>
export ROS_MASTER_URI=http://192.168.100.1:11311
```

**IMPORTANT** The above exports make your ROS **always** use the roscore of QTrobot. If you want to use your own roscore, comment those lines.

To check that the environment is setup correctly, in a new terminal tab list all the active ROS topics:
```
$ rostopic list
```

If you setup the system correctly, you should see all the robot's topics:
```
/add_file_to_robot
/camera/color/image_raw
/find_object/objects
/info
/interactive_interface_notes
/kid_tablet_images
/objectsStamped
/qt_robot/audio/play
/qt_robot/behavior/talkAudio
/qt_robot/behavior/talkText
/qt_robot/emotion/show
/qt_robot/gesture/play
/qt_robot/head_position/command
/qt_robot/joints/state
/qt_robot/left_arm_position/command
/qt_robot/motors/states
/qt_robot/right_arm_position/command
/qt_robot/speech/say
/robAPL_input_events
/robAPL_input_game
/robot_add_file_request
/robot_add_file_response
/rosout
/rosout_agg
/tf
```
and you can call them directly from terminal, e.g.:
```
$ rostopic pub /qt_robot/speech/say std_msgs/String "data: 'Success'"
```

If you have problems in sending command to QTrobot (and you did all the above steps correctly), try disabling your firewall:
```
$ sudo ufw disable
```

## Set up the iReCHeCk ROS package
Clone the content of this repo inside your catkin workspace (typically, inside the **catkin_ws/src/** folder).

ROS services rely on autogenerated C++ code (yep, even if you're only programming in Python), that is created by catkin_make:
```
$ cd ~/catkin_ws
$ catkin_make
```

iReCHeCk keeps all data collected at run-time in a Pandas dataframe, which is exported to a .csv file at the end of the session.

As specified in the script *irecheckWorld.py*, the .csv file is saved inside the **~/Documents/iReCHeCk_logs/** folder.

Create the folder before running the package, or change the path.

# System overview (TO BE UPDATED)
The overall iReCHeCk architecture is sketched in the file SWarchitecture.png.

# Usage Guide
Refer to the **README** guides of the single packages.

# Tips & Tricks (TO BE UPDATED)

1. To make a python script executable (e.g. "scripts/dbListener.py"): 
```
$ chmod +x scripts/dbListener.py
```

2. Whenever you create a new ROS message or ROS service in your package, you need to update CMakeLists.txt (and possibly package.xml as well) accordingly, and then re-run catkin_make. Refer to the ROS Tutorial http://wiki.ros.org/ROS/Tutorials/CreatingMsgAndSrv for instructions on how to do so.

3. If you want to slow down the movement of the QT to make idle movement more natural run the following commands:

rosservice call /qt_robot/motors/setVecity "parts:
- 'left_arm'
velocity: 4"

rosservice call /qt_robot/motors/setVecity "parts:
- 'right_arm'
velocity: 4"

4. To clone7pull/push from or to a branch, the syntax for the git command is:
```
$ git clone -b dorsa ssh://git@c4science.ch/source/iReCHeCk_repo.git
```

5. If you get the error ``unable to locate package python-pip`` when installing pip, try:
```
$ sudo add-apt-repository universe 
$ curl https://bootstrap.pypa.io/pip/2.7/get-pip.py --output get-pip2.py
$ sudo python get-pip2.py
```
